<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multi‑Countdown – Monate · Tage · Stunden · Sekunden</title>

  <!-- PWA / Icons -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">
  <link rel="icon" type="image/png" sizes="32x32" href="Icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="Icons/favicon-16x16.png">
  <link rel="apple-touch-icon" href="Icons/apple-touch-icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --bg: #0f172a;          /* sehr dunkel */
      --panel: #0b1220;       /* Kartenhintergrund */
      --line: #334155;        /* Rahmenfarbe */
      --text: #eaf2ff;        /* Haupttext – SEHR hell */
      --sub:  #cfe0ff;        /* Sekundärtext – hell */
      --accent: #facc15;      /* Gelb */
      --accent-2: #60a5fa;    /* Blau */
      --danger: #f87171;      /* Rot für Weihnachten-Default */
    }

    body { background: var(--bg); color: var(--text); }

    /* Kopfzeile */
    .app-title{ 
      font-weight: 900; 
      letter-spacing: .3px; 
      color: #ffffff; 
      text-shadow: 0 3px 16px rgba(250, 204, 21, .35), 0 1px 0 #000; 
    }
    #localTime { color: var(--accent); font-weight: 800; text-shadow: 0 0 10px rgba(250,204,21,.45); }

    /* Karten & Gitter */
    .card { background: var(--panel); border: 1px solid var(--line); overflow:hidden; }
    .card .card-body strong.event-title{ color:#fff; font-weight:900; letter-spacing:.2px; }
    .muted { color: var(--sub); }

    .timegrid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); 
      gap: 1rem; 
    }
    .timegrid > div{ 
      border-color: var(--line) !important; 
      background: #09101d; 
      padding: 1rem; 
      border-radius: .5rem; 
    }

    /* Countdown-Zahlen – hell & kontrastreich */
    .count-badge { 
      font-variant-numeric: tabular-nums; 
      font-weight: 900; 
      font-size: clamp(1.7rem, 4.2vw, 2.6rem);
      line-height: 1; 
      color: #ffffff; 
      text-shadow: 0 0 14px rgba(96,165,250,.45), 0 0 2px rgba(0,0,0,.9);
      white-space: nowrap;
    }
    .unit-label{ color:#e6edff; font-weight:700; text-transform:none; letter-spacing:.2px; }

    /* Formular – starke Lesbarkeit */
    .form-label{ color:#eaf2ff; font-weight:800; letter-spacing:.2px; }
    .form-control{ background:#0b1220; border-color:#4b5a75; color:#ffffff; font-weight:700; }
    .form-control::placeholder{ color:#b9c7e6; }
    .form-control:focus{ background:#0b1220; color:#fff; border-color: var(--accent); box-shadow: 0 0 0 .25rem rgba(250,204,21,.25); }
    .btn-primary{ background: var(--accent-2); border-color: var(--accent-2); font-weight:800; }
    .btn-primary:hover{ filter: brightness(1.08); }
    .badge.color-dot{ display:inline-block; width:.9rem; height:.9rem; border-radius:999px; border:1px solid #0003; }

    /* Fußnote (Hinweiszeile) – deutlich sichtbar */
    .hint{ 
      color:#ffffff; 
      background: linear-gradient(90deg, rgba(96,165,250,.12), rgba(250,204,21,.12));
      border:1px dashed #5b6b86; 
      padding:.75rem 1rem; 
      border-radius:.5rem; 
      font-weight:700;
    }
    .hint .mono{ font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }

    @media (max-width: 768px){
      .count-badge{ font-size: clamp(1.6rem, 6vw, 2.2rem); }
    }
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h3 m-0 app-title">Multi‑Countdown</h1>
      <span id="localTime"></span>
    </div>

    <!-- Formular: Termin hinzufügen -->
    <div class="card mb-4">
      <div class="card-body">
        <form id="addForm" class="row gy-3 gx-3 align-items-end">
          <div class="col-12 col-md-5">
            <label class="form-label">Titel</label>
            <input required type="text" id="title" class="form-control" placeholder="z. B. Weihnachten, Urlaub, Geburtstag" />
          </div>
          <div class="col-12 col-md-5">
            <label class="form-label">Datum &amp; Uhrzeit</label>
            <input required type="datetime-local" id="dt" class="form-control" />
          </div>
          <div class="col-6 col-md-1">
            <label class="form-label">Farbe</label>
            <input type="color" id="color" class="form-control form-control-color" value="#60a5fa" />
          </div>
          <div class="col-6 col-md-1 d-grid">
            <button class="btn btn-primary" type="submit">Hinzufügen</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Liste der Countdowns -->
    <div id="list" class="row g-3"></div>

    <!-- Deutliche Fußnote/Hinweis -->
    <p class="mt-4 hint">
      Hinweis: <strong>Monate</strong> werden als <strong>volle Kalendermonate</strong> berechnet (kein fixer 30‑Tage‑Monat). Danach folgen <span class="mono">Resttage · Stunden · Minuten · Sekunden</span>.
    </p>
  </div>

  <script>
    // ——— Utilities ———
    function pad(n){ return n.toString().padStart(2, '0'); }

    // Vollmonate + Rest-Komponenten kalendergenau
    function diffComponents(from, to){
      if (to < from){ return { past: true, months:0, days:0, hours:0, minutes:0, seconds:0 }; }
      // Clone (Mutation vermeiden)
      let a = new Date(from.getFullYear(), from.getMonth(), from.getDate(), from.getHours(), from.getMinutes(), from.getSeconds());
      const target = to;

      // ganze Kalendermonate zählen
      let months = 0;
      while (true){
        const next = new Date(a.getFullYear(), a.getMonth()+1, a.getDate(), a.getHours(), a.getMinutes(), a.getSeconds());
        if (next <= target){ a = next; months++; } else { break; }
      }

      // Rest in d/h/m/s
      let ms = target - a;
      const sec = 1000, min = 60*sec, hr = 60*min, day = 24*hr;
      const days = Math.floor(ms / day); ms -= days * day;
      const hours = Math.floor(ms / hr); ms -= hours * hr;
      const minutes = Math.floor(ms / min); ms -= minutes * min;
      const seconds = Math.floor(ms / sec);

      return { past:false, months, days, hours, minutes, seconds };
    }

    function germanDateTime(dt){
      return dt.toLocaleString('de-DE', { dateStyle: 'full', timeStyle: 'short' });
    }

    // ——— Storage (localStorage) ———
    const KEY = 'multiCountdown.events.v1';
    function loadEvents(){
      try { return JSON.parse(localStorage.getItem(KEY)) || []; } catch { return []; }
    }
    function saveEvents(evts){ localStorage.setItem(KEY, JSON.stringify(evts)); }

    // ——— Rendering ———
    const listEl = document.getElementById('list');

    function makeCard(evt, idx){
      const col = document.createElement('div');
      col.className = 'col-12 col-md-6 col-xl-4';

      const card = document.createElement('div');
      card.className = 'card h-100';

      const body = document.createElement('div');
      body.className = 'card-body d-flex flex-column';

      const head = document.createElement('div');
      head.className = 'd-flex justify-content-between align-items-center mb-2';
      head.innerHTML = `
        <div class="d-flex align-items-center gap-2">
          <span class="badge color-dot" style="background:${evt.color||'#60a5fa'}"></span>
          <strong class="event-title">${evt.title}</strong>
        </div>
        <button class="btn btn-sm btn-outline-danger" data-action="del" data-idx="${idx}">Löschen</button>
      `;

      const when = document.createElement('div');
      when.className = 'muted mb-3';
      when.textContent = germanDateTime(new Date(evt.when));

      const grid = document.createElement('div');
      grid.className = 'timegrid';
      grid.innerHTML = `
        <div class="text-center border rounded">
          <div class="count-badge" data-k="months">—</div>
          <div class="unit-label">Monate</div>
        </div>
        <div class="text-center border rounded">
          <div class="count-badge" data-k="days">—</div>
          <div class="unit-label">Tage</div>
        </div>
        <div class="text-center border rounded">
          <div class="count-badge" data-k="hours">—</div>
          <div class="unit-label">Stunden</div>
        </div>
        <div class="text-center border rounded">
          <div class="count-badge" data-k="minutes">—</div>
          <div class="unit-label">Minuten</div>
        </div>
        <div class="text-center border rounded">
          <div class="count-badge" data-k="seconds">—</div>
          <div class="unit-label">Sekunden</div>
        </div>`;

      const status = document.createElement('div');
      status.className = 'mt-3 small';
      status.dataset.role = 'status';

      body.append(head, when, grid, status);
      card.appendChild(body);
      col.appendChild(card);

      // Knoten für Update-Loop merken
      col._nodes = {
        months: grid.querySelector('[data-k="months"]'),
        days: grid.querySelector('[data-k="days"]'),
        hours: grid.querySelector('[data-k="hours"]'),
        minutes: grid.querySelector('[data-k="minutes"]'),
        seconds: grid.querySelector('[data-k="seconds"]'),
        status
      };
      col._when = new Date(evt.when);
      return col;
    }

    function render(){
      listEl.innerHTML = '';
      const evts = loadEvents();
      if (!evts.length){
        const empty = document.createElement('div');
        empty.className = 'col-12';
        empty.innerHTML = '<div class="card"><div class="card-body">Noch keine Termine – füge oben einen hinzu.</div></div>';
        listEl.appendChild(empty);
        return;
      }
      evts.forEach((evt, idx) => listEl.appendChild(makeCard(evt, idx)));
    }

    // ——— Live Update ———
    function tick(){
      const now = new Date();
      document.getElementById('localTime').textContent = 'Lokal: ' + germanDateTime(now);

      for (const col of listEl.children){
        if (!col._nodes) continue;
        const to = col._when;
        const diff = diffComponents(now, to);
        if (diff.past){
          col._nodes.status.textContent = 'Termin ist vorbei.';
          col._nodes.months.textContent = '0';
          col._nodes.days.textContent = '0';
          col._nodes.hours.textContent = '00';
          col._nodes.minutes.textContent = '00';
          col._nodes.seconds.textContent = '00';
        } else {
          col._nodes.status.textContent = `noch ${diff.months} Mon., ${diff.days} Tg, ${pad(diff.hours)}:${pad(diff.minutes)}:${pad(diff.seconds)}`;
          col._nodes.months.textContent = diff.months;
          col._nodes.days.textContent = diff.days;
          col._nodes.hours.textContent = pad(diff.hours);
          col._nodes.minutes.textContent = pad(diff.minutes);
          col._nodes.seconds.textContent = pad(diff.seconds);
        }
      }
    }

    setInterval(tick, 1000);

    // ——— Handlers ———
    document.getElementById('addForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const title = document.getElementById('title').value.trim();
      const dt = document.getElementById('dt').value;
      const color = document.getElementById('color').value;
      if (!title || !dt) return;
      const when = new Date(dt);
      if (isNaN(when)) return alert('Ungültiges Datum.');
      const evts = loadEvents();
      evts.push({ title, when: when.toISOString(), color });
      saveEvents(evts);
      (e.target).reset();
      document.getElementById('color').value = '#60a5fa';
      render();
      tick();
    });

    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-action="del"]');
      if (!btn) return;
      const idx = Number(btn.dataset.idx);
      const evts = loadEvents();
      evts.splice(idx, 1);
      saveEvents(evts);
      render();
    });

    // ——— Bootstrap: Weihnachten vorausfüllen ———
    (function seed(){
      const evts = loadEvents();
      if (evts.length) { render(); tick(); return; }
      const now = new Date();
      const year = (now.getMonth() > 11 || (now.getMonth() === 11 && now.getDate() > 25)) ? now.getFullYear()+1 : now.getFullYear();
      const christmas = new Date(year, 11, 25, 0, 0, 0); // 25.12. yyyy 00:00
      evts.push({ title: 'Weihnachten', when: christmas.toISOString(), color: '#f87171' });
      saveEvents(evts);
      render();
      tick();
    })();

    // ——— Service Worker registrieren (PWA) ———
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
